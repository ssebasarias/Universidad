-- Crear las tablas y datos necesarios
--     a. FACTURAS 
--     b. LINEAS_FACTURA 
--     c. CONTROL_LOG
--     d. PRODUCTOS
--     e. Crear los datos e insertarlos

CREATE TABLE FACTURAS (
  cod_factura NUMBER PRIMARY KEY,
  Fecha DATE,
  Descripcion VARCHAR2(100)
);

CREATE TABLE PRODUCTOS (
  COD_PRODUCTO NUMBER PRIMARY KEY,
  NOMBRE_PRODUCTO VARCHAR2(100),
  PVP NUMBER,
  TOTAL_VENDIDO NUMBER
);

CREATE TABLE LINEAS_FACTURAS (
  COD_PRODUCTO NUMBER,
  COD_FACTURA NUMBER,
  PVP NUMBER,
  UNIDADES NUMBER,
  FECHA DATE,
  PRIMARY KEY (COD_FACTURA, COD_PRODUCTO),
  FOREIGN KEY (COD_FACTURA) REFERENCES FACTURAS(COD_FACTURA),
  FOREIGN KEY (COD_PRODUCTO) REFERENCES PRODUCTOS(COD_PRODUCTO)
);

CREATE TABLE CONTROL_LOG (
  COD_EMPLEADO NUMBER,
  FECHA DATE,
  TABLA_AFECTADA VARCHAR2(50),
  COD_OPERACION CHAR(1),
  CONSTRAINT chk_operacion CHECK (COD_OPERACION IN ('I', 'U', 'D'))
);


BEGIN
    INSERT INTO FACTURAS (cod_factura, Fecha, Descripcion) VALUES (1, TO_DATE('2024-05-01', 'YYYY-MM-DD'), 'Compra de libros');
    INSERT INTO FACTURAS (cod_factura, Fecha, Descripcion) VALUES (2, TO_DATE('2024-05-02', 'YYYY-MM-DD'), 'Factura de prueba');
    INSERT INTO FACTURAS (cod_factura, Fecha, Descripcion) VALUES (3, TO_DATE('2024-04-28', 'YYYY-MM-DD'), 'Artículos de oficina');
    INSERT INTO FACTURAS (cod_factura, Fecha, Descripcion) VALUES (4, TO_DATE('2024-04-30', 'YYYY-MM-DD'), 'Material de construcción');
    INSERT INTO FACTURAS (cod_factura, Fecha, Descripcion) VALUES (5, TO_DATE('2024-05-05', 'YYYY-MM-DD'), 'Servicios de limpieza');

    INSERT INTO PRODUCTOS (COD_PRODUCTO, NOMBRE_PRODUCTO, PVP, TOTAL_VENDIDO) VALUES (1, 'Libro de ciencia', 20, 50);
    INSERT INTO PRODUCTOS (COD_PRODUCTO, NOMBRE_PRODUCTO, PVP, TOTAL_VENDIDO) VALUES (2, 'Bolígrafo azul', 1.5, 100);
    INSERT INTO PRODUCTOS (COD_PRODUCTO, NOMBRE_PRODUCTO, PVP, TOTAL_VENDIDO) VALUES (3, 'Martillo', 10, 30);
    INSERT INTO PRODUCTOS (COD_PRODUCTO, NOMBRE_PRODUCTO, PVP, TOTAL_VENDIDO) VALUES (4, 'Servicio de limpieza', 50, 20);
    INSERT INTO PRODUCTOS (COD_PRODUCTO, NOMBRE_PRODUCTO, PVP, TOTAL_VENDIDO) VALUES (5, 'Papel A4', 5, 200);

    INSERT INTO LINEAS_FACTURAS (COD_PRODUCTO, COD_FACTURA, PVP, UNIDADES, FECHA) VALUES (1, 1, 20, 2, TO_DATE('2024-05-01', 'YYYY-MM-DD'));
    INSERT INTO LINEAS_FACTURAS (COD_PRODUCTO, COD_FACTURA, PVP, UNIDADES, FECHA) VALUES (2, 1, 1.5, 10, TO_DATE('2024-05-01', 'YYYY-MM-DD'));
    INSERT INTO LINEAS_FACTURAS (COD_PRODUCTO, COD_FACTURA, PVP, UNIDADES, FECHA) VALUES (3, 2, 10, 1, TO_DATE('2024-05-02', 'YYYY-MM-DD'));
    INSERT INTO LINEAS_FACTURAS (COD_PRODUCTO, COD_FACTURA, PVP, UNIDADES, FECHA) VALUES (4, 5, 50, 1, TO_DATE('2024-05-05', 'YYYY-MM-DD'));
    INSERT INTO LINEAS_FACTURAS (COD_PRODUCTO, COD_FACTURA, PVP, UNIDADES, FECHA) VALUES (5, 3, 5, 4, TO_DATE('2024-04-28', 'YYYY-MM-DD'));

    INSERT INTO CONTROL_LOG (COD_EMPLEADO, FECHA, TABLA_AFECTADA, COD_OPERACION) VALUES (101, TO_DATE('2024-05-01', 'YYYY-MM-DD'), 'FACTURAS', 'I');
    INSERT INTO CONTROL_LOG (COD_EMPLEADO, FECHA, TABLA_AFECTADA, COD_OPERACION) VALUES (102, TO_DATE('2024-05-02', 'YYYY-MM-DD'), 'PRODUCTOS', 'I');
    INSERT INTO CONTROL_LOG (COD_EMPLEADO, FECHA, TABLA_AFECTADA, COD_OPERACION) VALUES (103, TO_DATE('2024-05-03', 'YYYY-MM-DD'), 'LINEAS_FACTURAS', 'U');
    INSERT INTO CONTROL_LOG (COD_EMPLEADO, FECHA, TABLA_AFECTADA, COD_OPERACION) VALUES (104, TO_DATE('2024-05-04', 'YYYY-MM-DD'), 'CONTROL_LOG', 'D');
    INSERT INTO CONTROL_LOG (COD_EMPLEADO, FECHA, TABLA_AFECTADA, COD_OPERACION) VALUES (105, TO_DATE('2024-05-05', 'YYYY-MM-DD'), 'FACTURAS', 'U');
END;
/
